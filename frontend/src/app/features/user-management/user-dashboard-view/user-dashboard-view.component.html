<div class="container mx-auto p-6">
  <div class="flex items-center mb-6">
    <button (click)="backToManageUsers()" class="btn btn-ghost btn-sm mr-4">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
      </svg>
      Back to Manage Users
    </button>
  </div>

  @if (loading()) {
    <div class="flex justify-center items-center h-64">
      <span class="loading loading-spinner loading-lg"></span>
    </div>
  }

  @if (!loading() && user()) {
    <!-- User Header -->
    <div class="card bg-base-100 shadow-xl mb-6">
      <div class="card-body">
        <div class="flex items-center justify-between">
          <div>
            <h1 class="text-3xl font-bold">{{ user()?.username }}'s Dashboard</h1>
            <p class="text-base-content/70 mt-1">{{ user()?.email }}</p>
          </div>
          <div class="flex gap-2">
            @for (role of user()?.roles ?? []; track role) {
              <span class="badge {{getRoleBadgeClass(role)}} badge-lg">
                {{ getRoleDisplay(role) }}
              </span>
            }
          </div>
        </div>
        <div class="divider"></div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="stat bg-warning/10 rounded-lg">
            <div class="stat-title">Pending</div>
            <div class="stat-value text-warning">{{ pendingCount() }}</div>
            <div class="stat-desc">Tasks to start</div>
          </div>
          <div class="stat bg-info/10 rounded-lg">
            <div class="stat-title">In Progress</div>
            <div class="stat-value text-info">{{ inProgressCount() }}</div>
            <div class="stat-desc">Currently working on</div>
          </div>
          <div class="stat bg-success/10 rounded-lg">
            <div class="stat-title">Completed</div>
            <div class="stat-value text-success">{{ completedCount() }}</div>
            <div class="stat-desc">Finished tasks</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Todos List -->
    <div class="card bg-base-100 shadow-xl">
      <div class="card-body">
        <h2 class="card-title mb-4">Tasks ({{ todos().length }} total)</h2>

        @if (todos().length === 0) {
          <div class="alert alert-info">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            <span>This user has no tasks assigned.</span>
          </div>
        } @else {
          <div class="overflow-x-auto">
            <table class="table table-zebra w-full">
              <thead>
                <tr>
                  <th>Title</th>
                  <th>Description</th>
                  <th>Status</th>
                  <th>Category</th>
                  <th>Due Date</th>
                  <th>Created</th>
                </tr>
              </thead>
              <tbody>
                @for (todo of todos(); track todo.id) {
                  <tr>
                    <td class="font-semibold">{{ todo.title }}</td>
                    <td>
                      <div class="max-w-xs truncate" [title]="todo.description">
                        {{ todo.description || 'No description' }}
                      </div>
                    </td>
                    <td>
                      <span class="badge {{getStatusBadgeClass(todo.status)}}">
                        {{ todo.status.replace('_', ' ') }}
                      </span>
                    </td>
                    <td>
                      <span class="badge {{getCategoryBadgeClass(todo.category)}}">
                        {{ todo.category }}
                      </span>
                    </td>
                    <td>{{ formatDate(todo.dueDate) }}</td>
                    <td>{{ formatDate(todo.createdAt ?? null) }}</td>
                  </tr>
                }
              </tbody>
            </table>
          </div>
        }
      </div>
    </div>
  }
</div>
