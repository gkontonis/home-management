<div class="container mx-auto p-6">
  <div class="flex flex-col sm:flex-row justify-between items-center mb-8 gap-4">
    <div>
      <h1 class="text-4xl font-bold text-primary">My Todos</h1>
      <p class="text-base-content/70 mt-2">Manage your tasks and stay organized</p>
    </div>
    <button class="btn btn-primary btn-lg gap-2" (click)="openCreateModal()">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
      </svg>
      New Todo
    </button>
  </div>

  <!-- Filter Tabs -->
  <div class="tabs tabs-boxed mb-8 bg-base-100 shadow-lg p-2">
    <button
      class="tab tab-lg gap-2"
      [class.tab-active]="filter() === 'all'"
      (click)="filter.set('all')"
    >
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
      </svg>
      All <span class="badge badge-primary">{{ filteredTodos().length }}</span>
    </button>
    <button
      class="tab tab-lg gap-2"
      [class.tab-active]="filter() === 'PENDING'"
      (click)="filter.set('PENDING')"
    >
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      Pending <span class="badge badge-warning">{{ countByStatus('PENDING') }}</span>
    </button>
    <button
      class="tab tab-lg gap-2"
      [class.tab-active]="filter() === 'IN_PROGRESS'"
      (click)="filter.set('IN_PROGRESS')"
    >
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
      </svg>
      In Progress <span class="badge badge-info">{{ countByStatus('IN_PROGRESS') }}</span>
    </button>
    <button
      class="tab tab-lg gap-2"
      [class.tab-active]="filter() === 'COMPLETED'"
      (click)="filter.set('COMPLETED')"
    >
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      Completed <span class="badge badge-success">{{ countByStatus('COMPLETED') }}</span>
    </button>
  </div>

  <!-- Todo List -->
  <div class="grid gap-6">
    @for (todo of filteredTodos(); track todo.id) {
      <div class="card bg-base-100 shadow-xl hover:shadow-2xl transition-all border-l-4" [ngClass]="{
        'border-warning': todo.status === 'PENDING',
        'border-info': todo.status === 'IN_PROGRESS',
        'border-success': todo.status === 'COMPLETED'
      }">
        <div class="card-body">
          <div class="flex justify-between items-start gap-4">
            <div class="flex-1">
              <h2 class="card-title text-2xl mb-2">{{ todo.title }}</h2>
              <p class="text-base-content/70">{{ todo.description }}</p>

              <div class="flex flex-wrap gap-2 mt-4">
                <span class="badge badge-lg" [ngClass]="getStatusClass(todo.status)">
                  {{ todo.status }}
                </span>
                <span class="badge badge-lg badge-outline">{{ todo.category }}</span>
                @if (todo.dueDate) {
                  <span class="badge badge-lg badge-ghost gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    Due: {{ formatDate(todo.dueDate) }}
                  </span>
                }
              </div>
            </div>

            <div class="dropdown dropdown-end">
              <label tabindex="0" class="btn btn-ghost btn-circle btn-sm">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" />
                </svg>
              </label>
              <ul tabindex="0" class="dropdown-content menu p-2 shadow-lg bg-base-100 rounded-box w-52 border border-base-300">
                <li>
                  <a (click)="openEditModal(todo)" class="gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                    </svg>
                    Edit
                  </a>
                </li>
                <li>
                  <a (click)="deleteTodo(todo.id!)" class="text-error gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                    </svg>
                    Delete
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    } @empty {
      <div class="hero bg-base-100 rounded-box shadow-xl">
        <div class="hero-content text-center py-16">
          <div class="max-w-md">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-24 w-24 mx-auto text-base-300 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
            </svg>
            <h3 class="text-2xl font-bold mb-2">No todos found</h3>
            <p class="text-base-content/70">Create your first todo to get started!</p>
          </div>
        </div>
      </div>
    }
  </div>
</div>

<!-- Create/Edit Modal -->
@if (showModal()) {
  <div class="modal modal-open">
    <div class="modal-box max-w-2xl">
      <h3 class="font-bold text-2xl mb-6 text-primary flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
        </svg>
        {{ isEditing() ? 'Edit Todo' : 'Create New Todo' }}
      </h3>

      <form (ngSubmit)="saveTodo()">
        <div class="form-control">
          <label class="label">
            <span class="label-text font-semibold">Title</span>
          </label>
          <input
            type="text"
            [(ngModel)]="currentTodo.title"
            name="title"
            class="input input-bordered input-primary w-full"
            placeholder="Enter todo title"
            required
          />
        </div>

        <div class="form-control mt-4">
          <label class="label">
            <span class="label-text font-semibold">Description</span>
          </label>
          <textarea
            [(ngModel)]="currentTodo.description"
            name="description"
            class="textarea textarea-bordered textarea-primary w-full"
            placeholder="Enter description (optional)"
            rows="3"
          ></textarea>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
          <div class="form-control">
            <label class="label">
              <span class="label-text font-semibold">Status</span>
            </label>
            <select
              [(ngModel)]="currentTodo.status"
              name="status"
              class="select select-bordered select-primary w-full"
            >
              <option value="PENDING">Pending</option>
              <option value="IN_PROGRESS">In Progress</option>
              <option value="COMPLETED">Completed</option>
            </select>
          </div>

          <div class="form-control">
            <label class="label">
              <span class="label-text font-semibold">Category</span>
            </label>
            <select
              [(ngModel)]="currentTodo.category"
              name="category"
              class="select select-bordered select-primary w-full"
            >
              <option value="HOUSEHOLD">Household</option>
              <option value="MAINTENANCE">Maintenance</option>
              <option value="GARDEN">Garden</option>
              <option value="CLEANING">Cleaning</option>
              <option value="OTHER">Other</option>
            </select>
          </div>
        </div>

        <div class="form-control mt-4">
          <label class="label">
            <span class="label-text font-semibold">Due Date (Optional)</span>
          </label>
          <input
            type="date"
            [(ngModel)]="currentTodo.dueDate"
            name="dueDate"
            class="input input-bordered input-primary w-full"
          />
        </div>

        @if (!isEditing()) {
          <div class="form-control mt-4">
            <label class="label">
              <span class="label-text font-semibold">Assign To</span>
            </label>
            <select
              [(ngModel)]="currentTodo.assignedToId"
              name="assignedToId"
              class="select select-bordered select-primary w-full"
              required
            >
              <option [value]="null" disabled>Select user</option>
              @for (user of users(); track user.id) {
                <option [value]="user.id">{{ user.username }}</option>
              }
            </select>
          </div>
        }

        <div class="modal-action">
          <button type="button" class="btn btn-outline" (click)="closeModal()">
            Cancel
          </button>
          <button type="submit" class="btn btn-primary gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
            {{ isEditing() ? 'Update' : 'Create' }}
          </button>
        </div>
      </form>
    </div>
    <div class="modal-backdrop" (click)="closeModal()"></div>
  </div>
}
